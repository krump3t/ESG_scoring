[pytest]
# Pytest configuration for ESG Evaluation System

# Test discovery patterns
# NOTE: Limited to specific test directories for SCA validation
# CP-2 tests are validated separately
testpaths = tests/crawler tests/parser tests/embedding tests/scoring tests/extraction tests/models tests/data_lake
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers for test categorization
markers =
    cp: Critical Path tests (must pass for SCA compliance)
    integration: Integration tests (test component interactions)
    e2e: End-to-end tests (complete pipeline validation with real data)
    slow: Slow tests (>1 second execution time)
    requires_api: Tests requiring external API access
    hypothesis: Property-based tests using Hypothesis

# Coverage configuration
addopts =
    -v
    --strict-markers
    --tb=short
    --cov=apps
    --cov=libs
    --cov=sca_infrastructure
    --cov=agents
    --cov-report=term-missing
    --cov-report=xml:qa/coverage.xml
    --cov-report=html:qa/htmlcov
    --cov-fail-under=0
    -m "not slow and not requires_api"
    --ignore=tests/test_integration.py
    --ignore=tests/test_scoring.py
    --ignore=tests/test_infrastructure.py
    --ignore=tests/test_phase4_integration.py
    --ignore=tests/crawler/data_providers
    --ignore=tests/crawler/test_multi_source_crawler.py
    --ignore=tests/crawler/test_sec_edgar_provider_enhanced.py
    --ignore=tests/crawler/test_multi_source_crawler_phase2.py

# Hypothesis settings
# These will be used unless overridden in tests
hypothesis_default_deadline = 5000
hypothesis_default_max_examples = 100

# Ignore warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::FutureWarning

# Output options
console_output_style = progress
junit_family = xunit2

# Timeout for tests (seconds)
timeout = 300
timeout_method = thread

# Parallel execution (if pytest-xdist installed)
# Uncomment to enable parallel testing
# addopts += -n auto

# Minimum Python version
minversion = 3.8

# Required plugins
required_plugins =
    pytest-cov
    pytest-mock
    pytest-timeout